worker_processes 1;

events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout 65;

    # Logging
    access_log /var/log/nginx/access.log;
    error_log  /var/log/nginx/error.log;

    server {
        listen 80;
        server_name localhost;

        # Serve all files from the nginx html root
        location / {
            root  /usr/share/nginx/html;
            index index.html index.htm;

            # ----------------------------------------------------------------
            # CORS headers â€” required for browser-based HLS players (HLS.js)
            # ----------------------------------------------------------------
            add_header 'Access-Control-Allow-Origin'  '*'                         always;
            add_header 'Access-Control-Allow-Methods' 'GET, HEAD, OPTIONS'        always;
            add_header 'Access-Control-Allow-Headers' 'Content-Type, User-Agent, Range' always;
            add_header 'Access-Control-Expose-Headers' 'Content-Length, Content-Range' always;

            # Handle pre-flight OPTIONS requests
            if ($request_method = 'OPTIONS') {
                add_header 'Access-Control-Allow-Origin'  '*';
                add_header 'Access-Control-Allow-Methods' 'GET, HEAD, OPTIONS';
                add_header 'Access-Control-Allow-Headers' 'Content-Type, User-Agent, Range';
                add_header 'Content-Length' 0;
                return 204;
            }
        }
    }

    # --------------------------------------------------------------------------
    # Custom MIME type overrides for HLS and DASH streaming files.
    # Only streaming-specific types are listed here; standard web types
    # (html, css, js, png, jpg, mp4, etc.) are already covered by the
    # included /etc/nginx/mime.types above.
    # --------------------------------------------------------------------------
    types {
        # HLS
        application/vnd.apple.mpegurl   m3u8;
        video/mp2t                       ts;

        # DASH
        application/dash+xml             mpd;
        video/mp4                        m4s;
    }
}
